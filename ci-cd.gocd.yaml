format_version: 2
environments:
  test:
    pipelines:
      - poc-build

pipelines:
  poc-build:
    group: poc
    label_template: "${mygit[:8]}"
    lock_behavior: none
#    parameters:
#      param1: value1
    materials:
      mygit:
        git: https://github.com/singals/gocd-poc.git
        branch: master
#      myupstream:
        # type: dependency
#        pipeline: pipe2
#        stage: test
    stages: # list of stages in order
      - build:
          fetch_material: yes
          keep_artifacts: yes
#          clean_workspace: yes
          environment_variables:
              PHASE: build
          jobs:
            run:
#              artifacts:
#                - build:
#                    source: main.sh
  #                  destination: build
#              tabs:
#                run: main.sh
              tasks:
                - exec:
                    command: bash
                    arguments:
                      - -c
                      - sh main.sh build
      - test:
          fetch_material: yes
          keep_artifacts: yes
#          clean_workspace: yes
          environment_variables:
            PHASE: test
          jobs:
            run:
#              artifacts:
#                - build:
#                    source: main.sh
  #                  destination: build
#              tabs:
#                run: main.sh
              tasks:
                - exec:
                    command: bash
                    arguments:
                      - -c
                      - sh main.sh test